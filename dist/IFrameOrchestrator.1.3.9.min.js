/*! IFrameOrchestrator - v1.3.9 - 2015-05-13
* https://github.com/InstanceOfAnObject/IFrameOrchestrator
* Copyright (c) 2015 ; Licensed  */
!function(){"use strict";var a={},b={allowedOrigins:"*",logging:!1},c={properties:{},subscriptions:{}},d=function(b){a.logging&&window.console&&console.log(b)},e=function(a){try{return JSON.parse(a)}catch(b){return null}},f=function(a,b,c){return a.addEventListener?(a.addEventListener(b,c,!1),!0):a.attachEvent?a.attachEvent("on"+b,c):(b="on"+b,"function"==typeof a[b]&&(c=function(a,b){return function(){a.apply(this,arguments),b.apply(this,arguments)}}(a[b],c)),a[b]=c,!0)},g=function(b){if("*"===a.allowedOrigins)return!0;b=b.toLowerCase();for(var c=a.allowedOrigins.length-1;c>=0;c--)if(b===a.allowedOrigins[c].toLowerCase())return!0;return d("Origin rejected: "+b),!1},h=function(a){return void 0===a||null===a||"object"!=typeof a||a.__ifo!==!0||isNaN(a.__ts)?!1:!0},i=function(a){return void 0!==a&&null!==a&&"string"==typeof a},j={setProperty:function(a,b){if(!i)throw new Error("IFrameOrchestrator [setProperty] Invalid property name");d("setting the property: "+a),c.properties[a]=b},getProperty:function(a){if(i)return d("getting the property: "+a),c.properties[a];throw new Error("IFrameOrchestrator [getProperty] Invalid property name")},triggerEvent:function(a,b){var d=c.subscriptions[a];if(d&&d.length>0)for(var e=d.length-1;e>=0;e--)if("host"===d[e].source)d[e].handler(b);else{var f={type:"eventBroadcast",name:a,data:b};d[e].source.postMessage(JSON.stringify(f),d[e].origin)}},subscribeEvent:function(a,b){if(d("IFrameOrchestrator subscribing to event: "+a),!i(a))throw new Error("IFrameOrchestrator [subscribeEvent] Invalid event name");var e={source:"host",handler:b};c.subscriptions[a]=c.subscriptions[a]||[],c.subscriptions[a].push(e)}},k={setProperty:function(a){var b=e(a.data);void 0!==b&&null!==b&&j.setProperty(b.action.data.key,b.action.data.value)},getProperty:function(a){var b=e(a.data);if(void 0!==b&&null!==b){var c=j.getProperty(b.action.data.key),f={type:"getPropertyReply",uuid:b.action.uuid,value:c};d("replying to: "+b.action.uuid),a.source.postMessage(JSON.stringify(f),a.origin)}},subscribeEvent:function(a){var b=e(a.data);if(void 0!==b&&null!==b){d("subscribing request to event: "+b.action.event.name);var f=b.action.event.name,g={source:a.source,origin:a.origin};c.subscriptions[f]=c.subscriptions[f]||[],c.subscriptions[f].push(g)}},unsubscribeEvent:function(a){var b=e(a.data);if(void 0!==b&&null!==b){d("unsubscribing request to event: "+b.action.event.name);var f=b.action.event.name;if(void 0!==c.subscriptions[f])for(var g=c.subscriptions[f].length-1;g>=0;g--)c.subscriptions[f][g].source===a.source&&c.subscriptions[f].splice(g,1)}},triggerEvent:function(a){var b=e(a.data);if(void 0!==b&&null!==b){d("trigger request of event: "+b.action.event.name);var f=b.action.event.name,g=b.action.event.data,h=b.iframe,i=c.subscriptions[f];if(i&&i.length>0)for(var j=i.length-1;j>=0;j--)if("host"===i[j].source)i[j].handler(g,{iframe:h});else{var k={type:"eventBroadcast",name:f,data:g};i[j].source.postMessage(JSON.stringify(k),i[j].origin)}}}},l=function(a){var b=null;a&&(a.data&&"string"==typeof a.data&&(b=e(a.data),void 0===b||null===b)||g(a.origin)&&h(b)&&(d("got your message"),k[b.action.type](a)))},m=function(){function c(c){if(c=c||{},"object"!=typeof c)throw new TypeError("Options is not an object.");for(var d in b)b.hasOwnProperty(d)&&(a[d]=c.hasOwnProperty(d)?c[d]:b[d])}return function(a){return c(a),{getProperty:j.getProperty,setProperty:j.setProperty,triggerEvent:j.triggerEvent,subscribeEvent:j.subscribeEvent}}};f(window,"message",l),"function"==typeof define&&define.amd?define(function(){return m()}):window.iframeOrchestrator=m()}();