/*! IFrameOrchestrator - v1.1.0 - 2014-11-16
* https://github.com/InstanceOfAnObject/IFrameOrchestrator
* Copyright (c) 2014 ; Licensed  */
!function(){"use strict";var a={},b={allowedOrigins:"*",logging:!1},c={properties:{},subscriptions:{}},d=function(b){a.logging&&window.console&&console.log(b)},e=function(a,b,c){return a.addEventListener?(a.addEventListener(b,c,!1),!0):a.attachEvent?a.attachEvent("on"+b,c):(b="on"+b,"function"==typeof a[b]&&(c=function(a,b){return function(){a.apply(this,arguments),b.apply(this,arguments)}}(a[b],c)),a[b]=c,!0)},f=function(b){if("*"===a.allowedOrigins)return!0;b=b.toLowerCase();for(var c=a.allowedOrigins.length-1;c>=0;c--)if(b===a.allowedOrigins[c].toLowerCase())return!0;return d("Origin rejected: "+b),!1},g=function(a){return void 0===a||null===a||"object"!=typeof a||a.__ifo!==!0||isNaN(a.__ts)?!1:!0},h=function(a){return void 0!==a&&null!==a&&"string"==typeof a},i={setProperty:function(a,b){if(!h)throw new Error("IFrameOrchestrator [setProperty] Invalid property name");d("setting the property: "+a),c.properties[a]=b},getProperty:function(a){if(h)return d("getting the property: "+a),c.properties[a];throw new Error("IFrameOrchestrator [getProperty] Invalid property name")},triggerEvent:function(a,b){var d=c.subscriptions[a];if(d&&d.length>0)for(var e=d.length-1;e>=0;e--){var f={type:"eventBroadcast",name:a,data:b};d[e].source.postMessage(f,d[e].origin)}}},j={setProperty:function(a){i.setProperty(a.data.action.data.key,a.data.action.data.value)},getProperty:function(a){var b=i.getProperty(a.data.action.data.key),c={type:"getPropertyReply",uuid:a.data.action.uuid,value:b};d("replying to: "+a.data.action.uuid),a.source.postMessage(c,a.origin)},subscribeEvent:function(a){d("subscribing request to event: "+a.data.action.event.name);var b=a.data.action.event.name,e={source:a.source,origin:a.origin};c.subscriptions[b]=c.subscriptions[b]||[],c.subscriptions[b].push(e)},unsubscribeEvent:function(a){d("unsubscribing request to event: "+a.data.action.event.name);var b=a.data.action.event.name;if(void 0!==c.subscriptions[b])for(var e=c.subscriptions[b].length-1;e>=0;e--)c.subscriptions[b][e].source===a.source&&c.subscriptions[b].splice(e,1)},triggerEvent:function(a){d("trigger request of event: "+a.data.action.event.name);var b=a.data.action.event.name,e=a.data.action.event.data,f=c.subscriptions[b];if(f&&f.length>0)for(var g=f.length-1;g>=0;g--){var h={type:"eventBroadcast",name:b,data:e};f[g].source.postMessage(h,f[g].origin)}}},k=function(a){f(a.origin)&&g(a.data)&&(d("got your message"),j[a.data.action.type](a))},l=function(){function c(c){if(c=c||{},"object"!=typeof c)throw new TypeError("Options is not an object.");for(var d in b)b.hasOwnProperty(d)&&(a[d]=c.hasOwnProperty(d)?c[d]:b[d])}return function(a){return c(a),{getProperty:i.getProperty,setProperty:i.setProperty,triggerEvent:i.triggerEvent}}};e(window,"message",k),"function"==typeof define&&define.amd?define(function(){return l()}):window.iframeOrchestrator=l()}();