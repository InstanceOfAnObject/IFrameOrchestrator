/*! IFrameOrchestrator - v1.3.7 - 2015-05-11
* https://github.com/InstanceOfAnObject/IFrameOrchestrator
* Copyright (c) 2015 ; Licensed  */
!function(){"use strict";var a={},b={allowedOrigins:"*",logging:!1},c={properties:{},subscriptions:{}},d=function(b){a.logging&&window.console&&console.log(b)},e=function(a,b,c){return a.addEventListener?(a.addEventListener(b,c,!1),!0):a.attachEvent?a.attachEvent("on"+b,c):(b="on"+b,"function"==typeof a[b]&&(c=function(a,b){return function(){a.apply(this,arguments),b.apply(this,arguments)}}(a[b],c)),a[b]=c,!0)},f=function(b){if("*"===a.allowedOrigins)return!0;b=b.toLowerCase();for(var c=a.allowedOrigins.length-1;c>=0;c--)if(b===a.allowedOrigins[c].toLowerCase())return!0;return d("Origin rejected: "+b),!1},g=function(a){return void 0===a||null===a||"object"!=typeof a||a.__ifo!==!0||isNaN(a.__ts)?!1:!0},h=function(a){return void 0!==a&&null!==a&&"string"==typeof a},i={setProperty:function(a,b){if(!h)throw new Error("IFrameOrchestrator [setProperty] Invalid property name");d("setting the property: "+a),c.properties[a]=b},getProperty:function(a){if(h)return d("getting the property: "+a),c.properties[a];throw new Error("IFrameOrchestrator [getProperty] Invalid property name")},triggerEvent:function(a,b){var d=c.subscriptions[a];if(d&&d.length>0)for(var e=d.length-1;e>=0;e--)if("host"===d[e].source)d[e].handler(b);else{var f={type:"eventBroadcast",name:a,data:b};d[e].source.postMessage(JSON.stringify(f),d[e].origin)}},subscribeEvent:function(a,b){if(d("IFrameOrchestrator subscribing to event: "+a),!h(a))throw new Error("IFrameOrchestrator [subscribeEvent] Invalid event name");var e={source:"host",handler:b};c.subscriptions[a]=c.subscriptions[a]||[],c.subscriptions[a].push(e)}},j={setProperty:function(a){var b=JSON.parse(a.data);i.setProperty(b.action.data.key,b.action.data.value)},getProperty:function(a){var b=JSON.parse(a.data),c=i.getProperty(b.action.data.key),e={type:"getPropertyReply",uuid:b.action.uuid,value:c};d("replying to: "+b.action.uuid),a.source.postMessage(JSON.stringify(e),a.origin)},subscribeEvent:function(a){var b=JSON.parse(a.data);d("subscribing request to event: "+b.action.event.name);var e=b.action.event.name,f={source:a.source,origin:a.origin};c.subscriptions[e]=c.subscriptions[e]||[],c.subscriptions[e].push(f)},unsubscribeEvent:function(a){var b=JSON.parse(a.data);d("unsubscribing request to event: "+b.action.event.name);var e=b.action.event.name;if(void 0!==c.subscriptions[e])for(var f=c.subscriptions[e].length-1;f>=0;f--)c.subscriptions[e][f].source===a.source&&c.subscriptions[e].splice(f,1)},triggerEvent:function(a){var b=JSON.parse(a.data);d("trigger request of event: "+b.action.event.name);var e=b.action.event.name,f=b.action.event.data,g=b.iframe,h=c.subscriptions[e];if(h&&h.length>0)for(var i=h.length-1;i>=0;i--)if("host"===h[i].source)h[i].handler(f,{iframe:g});else{var j={type:"eventBroadcast",name:e,data:f};h[i].source.postMessage(JSON.stringify(j),h[i].origin)}}},k=function(a){var b=null;a&&(a.data&&"string"==typeof a.data&&(b=JSON.parse(a.data)),f(a.origin)&&g(b)&&(d("got your message"),j[b.action.type](a)))},l=function(){function c(c){if(c=c||{},"object"!=typeof c)throw new TypeError("Options is not an object.");for(var d in b)b.hasOwnProperty(d)&&(a[d]=c.hasOwnProperty(d)?c[d]:b[d])}return function(a){return c(a),{getProperty:i.getProperty,setProperty:i.setProperty,triggerEvent:i.triggerEvent,subscribeEvent:i.subscribeEvent}}};e(window,"message",k),"function"==typeof define&&define.amd?define(function(){return l()}):window.iframeOrchestrator=l()}();